<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

</style>
<link rel="stylesheet" href="gloo_assets_321/gloo_style/stylesheets/style.css"/>
<link rel="stylesheet" href="gloo_assets_198/JORDANFRAY/ASSETS/STYLESHEETS/normalize.css"/>

<style>
.menu_buttons {
    text-align: center;
    font-size: 25px !important;
}

.title {
    text-align: center;
}

@font-face {
            font-family: "museosans_100";
            src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_100.ttf");
}

@font-face {
    font-family: "museosans_300";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_300.ttf");
}

@font-face {
    font-family: "museosans_500";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_500.ttf");
}

@font-face {
    font-family: "museosans_700";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_700.ttf");
}

@font-face {
    font-family: "museosans_900";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_900.ttf");
}

html, body {
    margin: 15px 15px;
}

h1 {
    font-family: "museosans_100";
    font-size: 1.3em;
    margin: 0 0 15px 0;
    color: #323232;
}

p {
    font-family: "Helvetica Neue";
    font-size: 14px;
    margin: 0 0 15px 0;
    color: #8b8b8b;
    font-weight: 400;
}

a {
    color: #38b3ce;
    font-family: "museosans_500";
    font-size: 12px;
}

hr {
    width: auto;
    height: 1px;
    background-color: #bdbdbd;
    border: none;
    margin: 0 0 15px 0;
}

.list-title {
    font-family: "Helvetica Neue";
    font-size: 13px;
    margin: 0 0 15px 0;
    color: #000;
    font-weight: 500;
}

.checked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    background: url("gloo_assets_321/gloo_sass/images/checkBoxFill.jpg") no-repeat 20px 20px;
    background-size: 100%;
    background-position: 92% 80%;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

.unchecked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

</style>
<body>
    <div class="title">
        <h1>Menu</h1>
    </div>
    <hr>
      <a class="btn full-width align-center" id="take">Take a Challenge</a>
    <hr>
    
    <div id="element1">
        <h2>Accepted Challenges</h2>
        <hr>
        <table id="table">
            <tr id="item1">
                <!--<td><div id="item1Checkbox" class="unchecked"></td>
                <td><div class="list-title">Step 1<br> <a href="">More Info</a></div></td> -->
            </tr>
            <!--<tr id="item2">
                <td><div id="item2Checkbox" class="unchecked"></td>
                <td><div class="list-title">Step 2<br> <a href="">More Info</a></div></td>
            </tr>
            <tr id="item3">
                <td><div id="item3Checkbox" class="unchecked"></td>
                <td><div class="list-title">Step 3<br> <a href="">More Info</a></div></td>
            </tr>
            <tr id="item4">
                <td><div id="item4Checkbox" class="unchecked"></td>
                <td><div class="list-title">Step 4<br> <a href="">More Info</a></div></td>
            </tr> -->
        </table>
    </div>
    
    <script>
    
    $(document).ready(function() {
        elementAPI.metrics()['score'].updateValueForMetric(0);
        
        /* Checklist */
        db = elementAPI.userData();
        alert("Stringed: " + JSON.stringify(db));
        
        /* Testing */
        var testArr = ["Challenge 1", "Challenge 2", "Challenge 3"];
        var numberOfItems = testArr.length; // get from getChallengesArray().length
        $("#table").find('tbody')
            .append($('<tr id="item5"></tr>')
                .append($('<td><div id="item1Checkbox" class="unchecked"></td><td><div class="list-title">Challenge 1<br> <a href="">More Info</a></div>')
                )
            );
        
        var check = function(number) {
            var c = "item" + number + "Checkbox";
            $("#" + c).click(function() {
                alert("#" + c);
                var d = elementAPI.userData().getValue(c);
                alert(d);
                if ( d === "true" || d === true) {
                    $("#" + c).removeClass("checked").addClass("unchecked");
                    db.setValue(c, false);
                } else {
                    $("#" + c).removeClass("unchecked").addClass("checked");
                    db.setValue(c, true);
                }
            });
        };
        
        for (var i = 0; i <= numberOfItems; i++) {
            var a = "item" + [i] + "Checkbox";
            var b = elementAPI.userData().getValue(a);
            if ( b === "true") {
                $("#" + a).removeClass("unchecked").addClass("checked");
            };
            check([i]);
        }
    });
    
    $("#take").click(function() {
        elementAPI.metrics()['score'].updateValueForMetric(1);
        setTimeout(function() {
        //Redirect to next element
        }, 500);
        alert(JSON.stringify(elementAPI.metrics()));
    });
    
    /*-- Parse and Stringify helper functions --*/
        
        var db = elementAPI.userData();
        
        var getChallengesArray = function () {
            if (db.getValue("acceptedChallenges")) {
                return JSON.parse(db.getValue("acceptedChallenges"));
            } else {
                return false;
            }
            
        };
        
        var getChallenge = function (index) {
            var arr = getChallengesArray();
            return arr[index];
        };
        
        var getCardAtIndex = function (index) {
            var arr = getChallengesArray();
            var challenge = getChallenge(index);
            return challenge.card;
        };
        
        var getStatusAtIndex = function (index) {
            var arr = getChallengesArray();
            var challenge = getChallenge(index);
            return challenge.completed;
        }
        
    //    var newDiv = function (card) {
    //        return ("<div>Title: " + card.title + " " + "Content: " + card.content "</div>");
    //    } 
        
        /* -- Temporary way to display challenges to test backend -- */
        
        var displayCompletedChallenges = function () {
            var challenges = getCompleted();
            
            for (var i = 0; i < challenges.length; i++) {
                $(body).append(newDiv(getCardAtIndex(i)));
            }
            
        };
        
        /*-- Get array of completed challenges--*/
        
        var anyCompleted = function () {
            if (getChallengesArray()) {
                for (var i = 0; i < getChallengesArray().length; i++) {
                    if (getStatusAtIndex(i)) {
                        return true;
                    }
                }
            } else {
                return false;
            }
        }
        
        var getCompleted = function () {
            var completed;
            if (anyCompleted) {
                completed = [];
                for (var i = 0; i < getChallengesArray().length; i++) {
                    if (getStatusAtIndex(i)) {
                        completed.push(getChallenge(i));
                    }
                } 
            }
            return completed;
        }
        
        
        $(document).ready(function() {
            if (getCompleted()) {
                displayCompletedChallenges(getCompleted());
            } else {
                alert("No completed challenges...YET!");
                //Redirect to menu?? That'd be cool
            }
        });
          
    </script>
</body>