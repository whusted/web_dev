<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="gloo_assets_75/cardsAssets/buttons/js/buttons.js"></script>

<link rel="stylesheet" href="gloo_assets_321/gloo_style/stylesheets/style.css"/>
<link rel="stylesheet" href="gloo_assets_198/JORDANFRAY/ASSETS/STYLESHEETS/normalize.css"/>
<link rel="stylesheet" type="text/css" href="gloo_assets_75/cardsAssets/buttons/css/reject_button.css"></link>
<link rel="stylesheet" type="text/css" href="gloo_assets_75/cardsAssets/buttons/css/accept_button.css"></link>

<style>
@font-face {
            font-family: "museosans_100";
            src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_100.ttf");
}

@font-face {
    font-family: "museosans_300";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_300.ttf");
}

@font-face {
    font-family: "museosans_500";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_500.ttf");
}

@font-face {
    font-family: "museosans_700";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_700.ttf");
}

@font-face {
    font-family: "museosans_900";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_900.ttf");
}

html {
   margin-left: 15px;
   margin-right: 15px;
}

h1 {
    font-family: "museosans_100";
    font-size: 1.3em;
    margin: 0 0 15px 0;
    color: #323232;
}

p {
    font-family: "Helvetica Neue";
    font-size: 14px;
    margin: 0 0 15px 0;
    color: #8b8b8b;
    font-weight: 400;
}

a {
    color: #38b3ce;
    font-family: "museosans_500";
    font-size: 12px;
}

hr {
    width: auto;
    height: 1px;
    background-color: #bdbdbd;
    border: none;
    margin: 0 0 15px 0;
}

.list-title {
    font-family: "Helvetica Neue";
    font-size: 13px;
    margin: 0 0 15px 0;
    color: #000;
    font-weight: 500;
}

.checked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    background: url("gloo_assets_321/gloo_sass/images/checkBoxFill.jpg") no-repeat 20px 20px;
    background-size: 100%;
    background-position: 92% 80%;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

.unchecked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

.title {
    animation: none !important;
    display: block !important;
    float: left;
    font-size: 1.0em;
    margin-top: -12px;
    width: 100%;
}

#checker {
    width: 20px;
}   

[id^="Challenge"] {
    float: top;
}

.hidden {
    display: none;
}

#content {
    font-size: 1em;
    color: gray;
}

#ready {
    text-align: center;
    font-size: 1.2em;
}

.take_ios {
    margin-top: 5%;
    margin-left: 30%;
}

.take_android {
    margin-top: 5%;
    margin-left: 33%;
}

#reset {
    text-align: center;
    font-size: 0.9em;
    color: gray;
}

</style>
<body>
    <div id="top">
        <br>
        <div id="ready">I'm ready for a new challenge!</div>
        <a href="#" id="take" class="accept-button accept-button-border-highlight accept-button-circle">+</a>
    </div>
    <br>
    <div>
        <hr>
        <table id="table">
            <tr></tr>
        </table>
    </div>
    <div id="reset"></div>
    
    <script>
    
     /*--------------- Card object/prototype ------------*/
        
    var Card = function (title, content, group, image, acceptImage) {
        this.title = title;
        this.content = content;
        this.group = group;
        this.image = image;
        this.acceptImage = acceptImage;
    };
    
    // Lame way to get the class
    var getClass = function (boolean) {
        if (boolean) {
            return "checked";
        } else {
            return "unchecked";
        }
    };
    
    var addRow = function (ID, Class, Group, Title, Content) {
        var newRow = '<td id="checker"><div id=' + ID + ' class=' + Class +'></td><td><div class="title">' + Group + ': ' + Title + '<div id="content" class="hidden">' + Content + '</div></td>';
        $("#table").find('tbody')
                .append($('<tr></tr>')
                    .append($(newRow)
                    )
                );
    };
    
    /*-- Parse and Stringify helper functions --*/
    
    var db = elementAPI.userData();
    
    var getChallengesArray = function () {
        console.log(db.getValue("acceptedChallenges"));
        if (db.getValue("acceptedChallenges")) {
            return JSON.parse(db.getValue("acceptedChallenges"));
        } else {
            return false;
        }
    };
    
    var getUnacceptedChallengesArray = function () {
        if (db.getValue("unacceptedChallenges")) {
            return JSON.parse(db.getValue("unacceptedChallenges"));
        } else {
            return false;
        }
    };
    
    var getChallenge = function (index) {
        var arr = getChallengesArray();
        return arr[index];
    };
    
    var getCardAtIndex = function (index) {
        var arr = getChallengesArray();
        var challenge = getChallenge(index);
        return challenge.card;
    };
    
    var getStatusAtIndex = function (index) {
        var arr = getChallengesArray();
        var challenge = getChallenge(index);
        return challenge.completed;
    };
    
    
    /*-- Get array of completed challenges--*/
    
    var anyCompleted = function () {
        if (getChallengesArray()) {
            for (var i = 0; i < getChallengesArray().length; i++) {
                if (getStatusAtIndex(i)) {
                    return true;
                }
            }
        } else {
            return false;
        }
    };
    
    var challengesArr = getChallengesArray();
    var numberOfItems = challengesArr.length;
    var count = 0;
    /*Initiate table with new rows, including toggle dropdowns*/
    var initiateTable = function () {
        var challenge;
        var Class;
        var Group;
        var Title;
        var Content;
        for (var i = 0; i < numberOfItems; i++) {
            challenge = challengesArr[i];
            Id =  "Challenge" + count;
            Class = getClass(challenge.completed);
            Group = challenge.card.group;
            Title = challenge.card.title;
            Content = challenge.card.content;
            addRow(Id, Class, Group, Title, Content);
            count++;
        }
    };
        
    var initializeNewChallengeDeck = function () {
        // First session, initialize array
        var unacceptedChallenges = [];
        var cards = [];
        
        cards[0] = new Card("The Name Game", "Pick a business you go into regularly (coffee shop, gym, bookstore, etc.). Learn one of the employee's names and have a simple conversation with them.", "GO", "gloo_assets_75/cardsAssets/images/name_game_cards.png", "gloo_assets_75/cardsAssets/images/name_game_accept.png");
        cards[1] = new Card("Trash Collector","Make the world a cleaner place. Grab a bag (and maybe some gloves) and walk up and down your block. Collect any trash you come across.","DO","gloo_assets_75/cardsAssets/images/trash_collector_cards.png","gloo_assets_75/cardsAssets/images/trash_collector_accept.png");
        cards[2] = new Card("Note of Encouragement", "Who in your life needs a little encouragement? Take a few minutes to send someone a note telling them why they are special to you.", "SAY", "gloo_assets_75/cardsAssets/images/note_encouragement_cards.png", "gloo_assets_75/cardsAssets/images/note_encouragement_accept.png");
        cards[3] = new Card("A Sweet Treat", "Give someone a little pick-me-up. Treat a coworker, classmate, etc. to a cup of coffee.", "GIVE", "gloo_assets_75/cardsAssets/images/sweet_treat_cards.png", "gloo_assets_75/cardsAssets/images/sweet_treat_accept.png");
        cards[4] = new Card("I'm All Ears", "We all want to feel heard. Be intentional to actively listen to those who talk to you today.", "SAY", "gloo_assets_75/cardsAssets/images/ears_cards.png", "gloo_assets_75/cardsAssets/images/ears_accept.png");
        cards[5] = new Card("Mi Casa, Su Casa", "The meal can be as simple as Kraft Mac N' Cheese. Invite someone over to your place for dinner.", "GO", "gloo_assets_75/cardsAssets/images/casa_cards.png", "gloo_assets_75/cardsAssets/images/casa_accept.png");
        cards[6] = new Card("Friendly Fast Food", "Here's a quick way to spread some joy. Pay for the meal of the person in line behind you.", "GIVE", "gloo_assets_75/cardsAssets/images/fast_food_cards.png", "gloo_assets_75/cardsAssets/images/fast_food_accept.png");
        cards[7] = new Card("Just Do It", "What's one chore your roomate/sibling hates the most? Cross that chore off of their to-do list today.", "GIVE", "gloo_assets_75/cardsAssets/images/just_do_it_cards.png", "gloo_assets_75/cardsAssets/images/just_do_it_accept.png");
        cards[8] = new Card("Fresh Baked", "There is nothing better than a freshly baked cookie. Whether you make them or get your mom to, bring in some homemade cookies for your classmates.", "DO", "gloo_assets_75/cardsAssets/images/fresh_baked_cards.png", "gloo_assets_75/cardsAssets/images/fresh_baked_accept.png");
        cards[9] = new Card("I Was Wrong", "We all have to say it from time to time. Admit a mistake you made today or in the past.", "SAY", "gloo_assets_75/cardsAssets/images/i_was_wrong_cards.png", "gloo_assets_75/cardsAssets/images/i_was_wrong_accept.png");
        cards[10] = new Card("A Literary Inspiration", "Which book has inspired you the most? Highlight or make notes of your favorite lines and leave a copy in the cafeteria. Be sure to leave a note that says, 'Free!' on it.", "GIVE", "gloo_assets_75/cardsAssets/images/literary_inspiration_cards.png", "gloo_assets_75/cardsAssets/images/literary_inspiration_accept.png");
        cards[11] = new Card("No Service", "Can you hear me now? Keep your phone in your pocket when you're talking with people today.", "DO", "gloo_assets_75/cardsAssets/images/no_service_cards.png", "gloo_assets_75/cardsAssets/images/no_service_accept.png");
        cards[12] = new Card("Give It Away", "What is collecting dust in your house? Give it away to someone who could actually use it.", "GIVE", "gloo_assets_75/cardsAssets/images/give_it_away_cards.png", "gloo_assets_75/cardsAssets/images/give_it_away_accept.png");
        cards[13] = new Card("Lost", "College campuses can be very confusing, especially when they are new to you. Keep your eyes out for someone who looks lost and help them find their way.", "GO", "gloo_assets_75/cardsAssets/images/lost_cards.png", "gloo_assets_75/cardsAssets/images/lost_accept.png");
        cards[14] = new Card("Natural Beauty", "Find a patch of wildflowers or get them from the grocery store. Give them to someone who appreciates nature.", "GO", "gloo_assets_75/cardsAssets/images/natural_beauty_cards.png", "gloo_assets_75/cardsAssets/images/natural_beauty_accept.png");
        cards[15] = new Card("Thank You", "Use your manners! Write 'Thank You' on a post-it note and leave it for your server the next time you go out for lunch.", "SAY", "gloo_assets_75/cardsAssets/images/thank_you_cards.png", "gloo_assets_75/cardsAssets/images/thank_you_accept.png");
        cards[16] = new Card("Take It Outside", "Up for a humble favor? Knock on your neighbor's door and ask them if you can take their trash out for them.", "GO", "gloo_assets_75/cardsAssets/images/take_it_outside_cards.png","gloo_assets_75/cardsAssets/images/take_it_outside_accept.png");
        cards[17] = new Card("Memory Lane", "'Remember that one time...?' Think of a funny memory to cheer up a friend who's feeling down.", "SAY", "gloo_assets_75/cardsAssets/images/memory_lane_cards.png", "gloo_assets_75/cardsAssets/images/memory_lane_accept.png");
        cards[18] = new Card("Mystery Giver", "What's your favorite place to get a sweet treat? Buy a gift card and leave it in a public place in your office/school with a note that says, 'Enjoy this one on me!'", "GIVE", "gloo_assets_75/cardsAssets/images/mystery_giver_cards.png", "gloo_assets_75/cardsAssets/images/mystery_giver_accept.png");
        cards[19] = new Card("You First", "We're all in a rush. As you wait in line today at the grocery store or wherever, be intentional about letting others cut in front of you.", "GIVE", "gloo_assets_75/cardsAssets/images/you_first_cards.png", "gloo_assets_75/cardsAssets/images/you_first_accept.png");
        // With all cards made, make challenges
        for (var i = 0; i < cards.length; i++) {
            var challenge = {card: cards[i], accepted: false, completed: false};
            unacceptedChallenges[i] = challenge;
        }
        var stringedArr = JSON.stringify(unacceptedChallenges);
        elementAPI.userData().setValue("unacceptedChallenges", stringedArr);
    };
    
    var addReset = function () {
        $("#reset").append("<a class='btn full-width align-center'>Reset Challenges</a>");
    };
    
    var addMessage = function () {
        $("#reset").append("<div>NO CHALLENGES ACCEPTED YET...</div>");
    };
    
    $(document).ready(function() {
        alert(elementAPI.userData().getValue("acceptedChallenges"));
        if (navigator.userAgent.match(/Android/i)) {
            $("#take").addClass("take_android");
        } else {
            $("#take").addClass("take_ios");
        }
        elementAPI.metrics()['score'].updateValueForMetric(0);
        if (getChallengesArray()) {
            // display rows of challenges
            initiateTable();
            addReset();
        } else {
            addMessage();
            if (!getUnacceptedChallengesArray()) {
                initializeNewChallengeDeck();
            }
        }
        
        /* Checklist */
        var check = function (number) {
            var n = "Challenge" + number;
            $("#" + n).click(function() {
                $("#" + n).toggleClass("checked");
                var updatedChallengesArr = getChallengesArray();
                var challenge = updatedChallengesArr[number];
                if (challenge.completed) {
                    challenge.completed = false;
                } else {
                    challenge.completed = true;
                }
                db.setValue("acceptedChallenges", JSON.stringify(updatedChallengesArr));
            });
        };
        if (getChallengesArray()) {
            for (var i = 0; i < numberOfItems; i++) {
                var a = "Challenge" + [i];
                $("#" + a).addClass("unchecked");
                var status = getStatusAtIndex(i);
                if (status) {
                    $("#" + a).addClass("checked");
                }
                check([i]);
            }
        }
    });
    
    $("#table").click(function() {
        var targ = $(event.target);
        var inner = targ.children().context.innerHTML;
        console.log(inner);
        var isMatch = inner.lastIndexOf("<div", 0) === 0;
        if (!targ.children().context.firstElementChild  && targ.children().context.innerHTML) {
            targ.slideToggle(500);
        } else if (!isMatch) {
            targ.children().slideToggle(500);
        }
        
    });
    
    $("#take").click(function() {
        elementAPI.metrics()['score'].updateValueForMetric(1);
        window.location.href = "gloo://app/applets/next_applet";
    });
    
    $("#reset").click(function() {
        if (confirm("Are you sure you want to reset your challenges?")) {
            initializeNewChallengeDeck();
            elementAPI.userData().setValue("acceptedChallenges", "");
            elementAPI.refresh();
        }
    });
          
    </script>
</body>