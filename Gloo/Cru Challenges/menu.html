<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>

<link rel="stylesheet" href="gloo_assets_321/gloo_style/stylesheets/style.css"/>
<link rel="stylesheet" href="gloo_assets_198/JORDANFRAY/ASSETS/STYLESHEETS/normalize.css"/>

<style>
@font-face {
            font-family: "museosans_100";
            src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_100.ttf");
}

@font-face {
    font-family: "museosans_300";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_300.ttf");
}

@font-face {
    font-family: "museosans_500";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_500.ttf");
}

@font-face {
    font-family: "museosans_700";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_700.ttf");
}

@font-face {
    font-family: "museosans_900";
    src: url("gloo_assets_321/gloo_sass/stylesheets/fonts/museosans_900.ttf");
}

html, body {
    margin: 15px 15px;
}

h1 {
    font-family: "museosans_100";
    font-size: 1.3em;
    margin: 0 0 15px 0;
    color: #323232;
}

p {
    font-family: "Helvetica Neue";
    font-size: 14px;
    margin: 0 0 15px 0;
    color: #8b8b8b;
    font-weight: 400;
}

a {
    color: #38b3ce;
    font-family: "museosans_500";
    font-size: 12px;
}

hr {
    width: auto;
    height: 1px;
    background-color: #bdbdbd;
    border: none;
    margin: 0 0 15px 0;
}

.list-title {
    font-family: "Helvetica Neue";
    font-size: 13px;
    margin: 0 0 15px 0;
    color: #000;
    font-weight: 500;
}

.checked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    background: url("gloo_assets_321/gloo_sass/images/checkBoxFill.jpg") no-repeat 20px 20px;
    background-size: 100%;
    background-position: 92% 80%;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

.unchecked {
    margin: 0 15px 15px 0;
    width: 26px;
    height: 26px;
    border-radius: 4px;
    border: 1px solid #7c7c7c;
    background-color: #fafafa;
    -webkit-box-shadow: inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    -moz-box-shadow:    inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
    box-shadow:         inset 0px 1px 2px 0px rgba(50, 50, 50, 0.6);
}

td {
    height: 50px; 
    width:50px;
    text-align:center; 
}

.title {
    animation: none !important;
    display: block !important;
}

[id^="Challenge"] {
   position: absolute;
}

.hidden {
   display: none;
}

</style>
<body>
    <div class="align-center">
        <h2>Menu</h2>
    </div>
    <hr>
      <a class="btn full-width align-center" id="take">Take a Challenge</a>
    <hr>
    
    <div class="align-center">
        <h2>Challenges</h2>
        <hr>
        <table id="table">
            <tr></tr>
        </table>
    </div>
    
    <script>
    
    // Lame way to get the class
    var getClass = function (boolean) {
        if (boolean) {
            return "checked";
        } else {
            return "unchecked";
        }
    };
    
    var addRow = function (ID, Class, Title, Content) {
        var newRow = '<td><div id=' + ID + ' class=' + Class +'></td><td><div class="title">' + Title + '<div class="hidden">' + Content + '</div></td>';
        $("#table").find('tbody')
                .append($('<tr></tr>')
                    .append($(newRow)
                    )
                );
    };
    
    /*-- Parse and Stringify helper functions --*/
    
    var db = elementAPI.userData();
    
    var getChallengesArray = function () {
        if (db.getValue("acceptedChallenges")) {
            return JSON.parse(db.getValue("acceptedChallenges"));
        } else {
            return false;
        }
        
    };
    
    var getChallenge = function (index) {
        var arr = getChallengesArray();
        return arr[index];
    };
    
    var getCardAtIndex = function (index) {
        var arr = getChallengesArray();
        var challenge = getChallenge(index);
        return challenge.card;
    };
    
    var getStatusAtIndex = function (index) {
        var arr = getChallengesArray();
        var challenge = getChallenge(index);
        return challenge.completed;
    };
    
    
    /*-- Get array of completed challenges--*/
    
    var anyCompleted = function () {
        if (getChallengesArray()) {
            for (var i = 0; i < getChallengesArray().length; i++) {
                if (getStatusAtIndex(i)) {
                    return true;
                }
            }
        } else {
            return false;
        }
    };
    
    var challengesArr = getChallengesArray();
    var numberOfItems = challengesArr.length;
    var count = 0;
    /*Initiate table with new rows, including toggle dropdowns*/
        var initiateTable = function () {
            var challenge;
            var Class;
            var Title;
            var Content;
            for (var i = 0; i < numberOfItems; i++) {
                challenge = challengesArr[i];
                Id =  "Challenge" + count;
                Class = getClass(challenge.completed);
                Title = challenge.card.title;
                Content = challenge.card.content;
                addRow(Id, Class, Title, Content);
                count++;
            }
        };
    
    $(document).ready(function() {
        elementAPI.metrics()['score'].updateValueForMetric(0);
        if (getChallengesArray()) {
            // display rows of challenges
            initiateTable();
        } else {
            alert("You haven't accepted any challenges...YET!");
        }
        
        //testing
        
        //addRow("Challenge1", "unchecked", "Challenge1", "content content content");
        //addRow("Challenge2", "checked", "Challenge2", "content2 content2 content2");
        
        /* Checklist */
        var check = function (number) {
            var n = "Challenge" + number;
            $("#" + n).click(function() {
                $("#" + n).toggleClass("checked");
                var updatedChallengesArr = getChallengesArray();
                var challenge = updatedChallengesArr[number];
                if (challenge.completed) {
                    challenge.completed = false;
                } else {
                    challenge.completed = true;
                }
                db.setValue("acceptedChallenges", JSON.stringify(updatedChallengesArr));
            });
        };
        if (getChallengesArray()) {
            for (var i = 0; i < numberOfItems; i++) {
                var a = "Challenge" + [i];
                $("#" + a).addClass("unchecked");
                var status = getStatusAtIndex(i);
                if (status) {
                    $("#" + a).addClass("checked");
                }
                check([i]);
            }
        }
    });
    
    $("#table").click(function() {
        var targ = $(event.target);
        var inner = targ.children().context.innerHTML;
        var isMatch = inner.lastIndexOf("<div", 0) === 0;
        if (!isMatch) {
            targ.children().slideToggle(500);
        }
        
    });
    
    $("#take").click(function() {
        elementAPI.metrics()['score'].updateValueForMetric(1);
        setTimeout(function() {
        //Redirect to next element with chromeless
        }, 500);
        alert(JSON.stringify(elementAPI.metrics()));
    });
          
    </script>
</body>